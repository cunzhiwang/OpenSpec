# specs-sync-skill 规范

## 目的
定义用于将增量规范从变更同步到主规范的代理技能。

## 需求

### 需求：Specs Sync 技能
系统应当提供 `/opsx:sync` 技能，将增量规范从变更同步到主规范。

#### 场景：将增量规范同步到主规范
- **当** 代理使用变更名称执行 `/opsx:sync` 时
- **则** 代理从 `openspec/changes/<name>/specs/` 读取增量规范
- **且** 从 `openspec/specs/` 读取相应的主规范
- **且** 协调主规范以匹配增量描述的内容

#### 场景：幂等操作
- **当** 代理对同一变更多次执行 `/opsx:sync` 时
- **则** 结果与运行一次相同
- **且** 不创建重复需求

#### 场景：变更选择提示
- **当** 代理执行 `/opsx:sync` 而未指定变更时
- **则** 代理提示用户从可用变更中选择
- **且** 显示有增量规范的变更

### 需求：增量协调逻辑
代理应当使用增量操作头协调主规范与增量规范。

#### 场景：ADDED 需求
- **当** 增量包含带有需求的 `## ADDED Requirements` 时
- **且** 需求不存在于主规范中
- **则** 将需求添加到主规范

#### 场景：ADDED 需求已存在
- **当** 增量包含带有需求的 `## ADDED Requirements` 时
- **且** 主规范中已存在同名需求
- **则** 更新现有需求以匹配增量版本

#### 场景：MODIFIED 需求
- **当** 增量包含带有需求的 `## MODIFIED Requirements` 时
- **且** 需求存在于主规范中
- **则** 用增量版本替换主规范中的需求

#### 场景：REMOVED 需求
- **当** 增量包含带有需求名称的 `## REMOVED Requirements` 时
- **且** 需求存在于主规范中
- **则** 从主规范中移除该需求

#### 场景：RENAMED 需求
- **当** 增量包含带有 FROM:/TO: 格式的 `## RENAMED Requirements` 时
- **且** FROM 需求存在于主规范中
- **则** 将需求重命名为 TO 名称

#### 场景：新能力规范
- **当** 增量规范存在于主规范中没有的能力时
- **则** 在 `openspec/specs/<capability>/spec.md` 创建新的主规范文件

### 需求：技能输出
技能应当提供关于应用内容的清晰反馈。

#### 场景：显示应用的变更
- **当** 协调成功完成时
- **则** 显示每个能力的变更摘要：
  - 添加的需求数量
  - 修改的需求数量
  - 移除的需求数量
  - 重命名的需求数量

#### 场景：无需更改
- **当** 主规范已匹配增量规范时
- **则** 显示 "Specs already in sync - no changes needed"
