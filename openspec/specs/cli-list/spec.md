# 列表命令规范

## 目的

`openspec list` 命令应当为开发者提供项目中所有活动变更的快速概览，显示其名称和任务完成状态。

## 需求
### 需求：命令执行
命令应当根据选定的模式扫描和分析活动变更或规范。

#### 场景：扫描变更（默认）
- **当** 执行 `openspec list` 而不带标志时
- **则** 扫描 `openspec/changes/` 目录查找变更目录
- **并且** 从结果中排除 `archive/` 子目录
- **并且** 解析每个变更的 `tasks.md` 文件以计算任务完成情况

#### 场景：扫描规范
- **当** 执行 `openspec list --specs` 时
- **则** 扫描 `openspec/specs/` 目录查找能力
- **并且** 读取每个能力的 `spec.md`
- **并且** 解析需求以计算需求数量

### 需求：任务计数

命令应当使用标准 markdown 复选框模式准确计算任务完成状态。

#### 场景：计算 tasks.md 中的任务

- **当** 解析 `tasks.md` 文件时
- **则** 计算匹配以下模式的任务：
  - 已完成：包含 `- [x]` 的行
  - 未完成：包含 `- [ ]` 的行
- **并且** 将已完成和未完成的总和计算为总任务数

### 需求：输出格式
命令应当以清晰、可读的表格格式显示项目，包含模式适当的进度或计数。

#### 场景：显示变更列表（默认）
- **当** 显示变更列表时
- **则** 显示包含以下列的表格：
  - 变更名称（目录名）
  - 任务进度（例如 "3/5 任务" 或 "✓ 完成"）

#### 场景：显示规范列表
- **当** 显示规范列表时
- **则** 显示包含以下列的表格：
  - 规范 ID（目录名）
  - 需求数量（例如 "需求 12"）

### 需求：标志
命令应当接受标志以选择要列出的名词。

#### 场景：选择规范
- **当** 提供 `--specs` 时
- **则** 列出规范而不是变更

#### 场景：选择变更
- **当** 提供 `--changes` 时
- **则** 显式列出变更（与默认行为相同）

### 需求：空状态
当所选模式没有项目时，命令应当提供清晰的反馈。

#### 场景：处理空状态（变更）
- **当** 不存在活动变更（只有 archive/ 或 changes/ 为空）时
- **则** 显示："未找到活动变更。"

#### 场景：处理空状态（规范）
- **当** specs 目录不存在或不包含能力时
- **则** 显示："未找到规范。"

### 需求：错误处理

命令应当优雅地处理缺失的文件和目录，并显示适当的消息。

#### 场景：缺少 tasks.md 文件

- **当** 变更目录没有 `tasks.md` 文件时
- **则** 显示该变更的"无任务"状态

#### 场景：缺少变更目录

- **当** `openspec/changes/` 目录不存在时
- **则** 显示错误："未找到 OpenSpec 变更目录。请先运行 'openspec init'。"
- **并且** 以退出码 1 退出

### 需求：排序

命令应当保持变更的一致排序，以获得可预测的输出。

#### 场景：变更排序

- **当** 显示多个变更时
- **则** 按变更名称字母顺序排序

## 原因

开发者需要一种快速方式来：
- 查看正在进行的变更
- 识别哪些变更已准备好归档
- 了解整体项目演进状态
- 无需打开多个文件即可获得全局视图

此命令以最小的努力提供该可见性，遵循 OpenSpec 的简单和清晰哲学。
