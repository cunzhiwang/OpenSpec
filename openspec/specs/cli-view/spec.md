# CLI View 规范

## 目的

`openspec view` 命令提供 OpenSpec 项目状态的综合仪表板视图，以统一、美观的格式显示规范、变更和进度指标，帮助开发者快速了解项目状态。

## 需求
### 需求：仪表板显示

系统应当提供显示规范和变更仪表板概览的 `view` 命令。

#### 场景：基本仪表板显示

- **当** 用户运行 `openspec view` 时
- **则** 系统显示格式化的仪表板，包含摘要、活动变更、已完成变更和规范部分

#### 场景：无 OpenSpec 目录

- **当** 用户在没有 OpenSpec 的目录中运行 `openspec view` 时
- **则** 系统显示错误消息 "✗ 未找到 openspec 目录"

### 需求：摘要部分

仪表板应当显示包含关键项目指标的摘要部分，包括草稿变更计数。

#### 场景：完整摘要显示

- **当** 仪表板渲染规范和变更时
- **则** 系统显示规范和需求总数
- **并且** 显示草稿变更数量
- **并且** 显示进行中的活动变更数量
- **并且** 显示已完成变更数量
- **并且** 显示整体任务进度百分比

#### 场景：空项目摘要

- **当** 不存在规范或变更时
- **则** 摘要显示所有指标为零

### 需求：活动变更显示
仪表板应当显示带有可视进度指示器的活动变更。

#### 场景：按完成百分比排序活动变更
- **当** 显示带有进度信息的多个活动变更时
- **则** 按完成百分比升序排列，0% 项目最先显示
- **并且** 将缺失的进度值视为 0% 进行排序
- **并且** 按变更标识符字母升序打破平局，保持输出确定性

### 需求：已完成变更显示

仪表板应当在单独部分列出已完成变更，仅显示所有任务都已完成的变更。

> **修复 bug**：之前 `total === 0` 的变更被错误地显示为已完成。

#### 场景：已完成变更列表

- **当** 存在 `tasks.total > 0` 且 `tasks.completed === tasks.total` 的变更时
- **则** 系统在专门部分用勾选指示器显示它们

#### 场景：混合完成状态

- **当** 某些变更完成而其他处于活动状态时
- **则** 系统将它们分到适当的部分

#### 场景：空变更未完成

- **当** 变更没有 tasks.md 或定义了零个任务时
- **则** 系统不在"已完成变更"部分显示它
- **并且** 改为在"草稿变更"部分显示

### 需求：规范显示

仪表板应当按需求数量排序显示规范。

#### 场景：带计数的规范列表

- **当** 项目中存在规范时
- **则** 系统按需求数量（降序）排序显示规范，带计数标签

#### 场景：有解析错误的规范

- **当** 规范文件无法解析时
- **则** 系统将其包含在列表中，需求数量为 0

### 需求：视觉格式化

仪表板应当使用一致的颜色和符号进行视觉格式化。

#### 场景：颜色编码

- **当** 显示仪表板元素时
- **则** 系统对规范项目使用青色
- **并且** 对活动变更使用黄色
- **并且** 对已完成项目使用绿色
- **并且** 对辅助文本使用暗灰色

#### 场景：进度条渲染

- **当** 显示进度条时
- **则** 系统对已完成部分使用实心块（█），对剩余部分使用浅色块（░）

### 需求：错误处理

view 命令应当优雅地处理错误。

#### 场景：文件系统错误

- **当** 文件系统操作失败时
- **则** 系统继续使用可用数据并省略不可访问的项目

#### 场景：无效数据结构

- **当** 规范或变更格式无效时
- **则** 系统跳过无效项目并继续渲染

### 需求：草稿变更显示

仪表板应当在单独的"草稿"部分显示没有任务的变更。

#### 场景：草稿变更列表

- **当** 存在没有 tasks.md 或定义了零个任务的变更时
- **则** 系统在"草稿变更"部分显示它们
- **并且** 使用独特指示器（例如 `○`）显示草稿状态

#### 场景：草稿部分排序

- **当** 存在多个草稿变更时
- **则** 系统按名称字母顺序排序
